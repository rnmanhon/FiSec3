(function(){angular.module("fisecApp",["ngRoute","ui.bootstrap","leaflet-directive"]).constant("_",window._).config(function($logProvider){$logProvider.debugEnabled(false)});function config($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/view/home.view.html",controller:"homeController",controllerAs:"vm"}).when("/user",{templateUrl:"/view/user.view.html",controller:"userController",controllerAs:"vm"}).when("/app",{templateUrl:"/view/app.view.html",controller:"appController",controllerAs:"vm"}).when("/role",{templateUrl:"/view/role.view.html",controller:"roleController",controllerAs:"vm"}).when("/userRole",{templateUrl:"/view/userRole.view.html",controller:"userRoleController",controllerAs:"vm"}).when("/auth",{templateUrl:"/view/auth.view.html",controller:"authController",controllerAs:"vm"}).when("/map",{templateUrl:"/view/map.view.html",controller:"mapController",controllerAs:"vm"}).when("/facebook",{templateUrl:"/view/facebook.view.html",controller:"facebookController",controllerAs:"vm"}).when("/secApp",{templateUrl:"/view/secapp.view.html",controller:"secappController",controllerAs:"vm"}).otherwise({redirectTo:"/"});$locationProvider.html5Mode({enabled:true,requireBase:false})}angular.module("fisecApp").config(["$routeProvider","$locationProvider",config])})();(function(){angular.module("fisecApp").controller("homeController",homeController);homeController.$inject=["$scope"];function homeController($scope){console.log("inside homeController ...");var vm=this;console.log(window.location);vm.pageHeader={title:"FiSec",strapline:"Checing what is going on inside fiware security!"};vm.sidebar={content:"The overall ambition of the Security Architecture of FIWARE is to demonstrate that the Vision of an Internet that is secure by design is becoming reality. Based on achievements to date and/or to come in the short-term (both from a technological but also a standardization perspective) we will show that secure by design is possible for the most important core (basic) and shared (generic) security features as anticipated by the FIWARE project and in accordance with the requirements of external stakeholders and users. Therefore, the secure by design concept will address both the security properties of the FIWARE platform itself and the applications that will be built on top of it. As such, the Security Architecture will focus on key security features such as identity management, access control or security monitoring to be delivered as so-called generic security enablers which, by design, can be integrated with other FIWARE GEs."};vm.message=""}})();(function(){angular.module("fisecApp").controller("userController",userController);userController.$inject=["$scope","$uibModal","userService"];function userController($scope,$uibModal,userService){console.log("inside userController ...");var vm=this;vm.loginToken=userService.loginToken;vm.pageHeader={title:"FiSec",strapline:"Keystone user"};vm.message="";vm.popupLoginForm=function(){console.log("userController userController ...");var uibModalInstance=$uibModal.open({templateUrl:"/view/loginModal.view.html",controller:"loginController as vm"});uibModalInstance.result.then(function(data){userService.loginToken=data.token;vm.loginToken=userService.loginToken;console.log("userController userController return token "+vm.loginToken)})};vm.onRefresh=function(){console.log("userController onaRefresh ...");vm.message="loading ...";userService.users({userToken:vm.loginToken}).success(function(data){console.log("data %j",data);vm.users=data.users;console.log("user list %j",vm.users);vm.message=""}).error(function(e){console.log(e);vm.message=e})};vm.popupNewUserForm=function(){console.log("userController popupNewUserForm ...");var uibModalInstance=$uibModal.open({templateUrl:"/view/addUserModal.view.html",controller:"addUserController as vm",resolve:{creator:function(){return{userToken:vm.loginToken}}}})}}})();(function(){angular.module("fisecApp").controller("addUserController",addUserController);addUserController.$inject=["$uibModalInstance","$scope","userService","creator"];function addUserController($uibModalInstance,$scope,userService,creator){console.log("inside addUserController ...");var vm=this;vm.onSubmit=function(){console.log("addUserController onSubmit ...");vm.formError="";if(!vm.formData.name||!vm.formData.password){vm.formError="user name and password are required, please try again";return false}else{vm.doAddUser(creator.userToken,vm.formData)}};vm.doAddUser=function(userToken,formData){console.log("addUserController doAddUser ...");console.log("token "+userToken);console.log("formData %j",formData);userService.addUser({userToken:userToken,name:formData.name,userName:formData.userName,defaultProjectId:formData.defaultProjectId,description:formData.description,domainId:formData.domainId,email:formData.email,enabled:formData.enabled,password:formData.password}).success(function(data){alert("user created!");vm.modal.close(data)}).error(function(data){vm.formError="User cannot be created, please try again"});return false};vm.modal={close:function(result){$uibModalInstance.close(result)},cancel:function(){$uibModalInstance.dismiss("cancel")}}}})();(function(){angular.module("fisecApp").controller("addRoleController",addRoleController);addRoleController.$inject=["$uibModalInstance","$scope","roleService","creator"];function addRoleController($uibModalInstance,$scope,roleService,creator){console.log("inside addUserController ...");var vm=this;vm.onSubmit=function(){console.log("addUserController onSubmit ...");vm.formError="";if(!vm.formData.name){vm.formError="role name and is required, please try again";return false}else{vm.doAddRole(creator.userToken,vm.formData)}};vm.doAddRole=function(userToken,formData){console.log("addRoleController doAddRole ...");console.log("token "+userToken);console.log("formData %j",formData);roleService.addRole({userToken:userToken,name:formData.name,application_id:formData.application_id}).success(function(data){alert("role created!");vm.modal.close(data)}).error(function(data){vm.formError="Role cannot be created, please try again"});return false};vm.modal={close:function(result){$uibModalInstance.close(result)},cancel:function(){$uibModalInstance.dismiss("cancel")}}}})();(function(){angular.module("fisecApp").controller("loginController",loginController);loginController.$inject=["$scope","$uibModalInstance","loginService"];function loginController($scope,$uibModalInstance,loginService){console.log("inside loginController ...");var vm=this;vm.onSubmit=function(){console.log("loginController onSubmit ...");vm.formError="";if(!vm.formData.name||!vm.formData.password){vm.formError="user name and password are required, please try again";return false}else{vm.doLogin(vm.formData)}};vm.doLogin=function(formData){console.log("loginController doLogin ...");loginService.login({name:formData.name,password:formData.password,domainId:formData.domainId}).success(function(data){vm.modal.close(data)}).error(function(data){if(typeof data.messsage=="undefined"){vm.formError=data.message}else{vm.formError="User cannot be login, please try again"}});return false};vm.modal={close:function(result){$uibModalInstance.close(result)},cancel:function(){$uibModalInstance.dismiss("cancel")}}}})();(function(){angular.module("fisecApp").controller("appController",appController);appController.$inject=["$scope","$uibModal","userService","appService"];function appController($scope,$uibModal,userService,appService){console.log("inside appController ...");var vm=this;vm.loginToken=userService.loginToken;vm.authorizedApp=appService.authorizedApp;vm.appAccessToken=appService.appAccessToken;vm.pageHeader={title:"FiSec",strapline:"Consumer / Application"};vm.message="";vm.onRefresh=function(){console.log("appController onaRefresh ...");vm.message="loading ...";appService.apps().success(function(data){console.log("data %j",data);vm.consumers=data.consumers;console.log("consumers list %j",vm.consumers);vm.message=""}).error(function(e){console.log(e);vm.message=e})};vm.popupNewAppForm=function(){console.log("appController popupNewAppForm ...");var uibModalInstance=$uibModal.open({templateUrl:"/view/addUserModal.view.html",controller:"addAppController as vm",resolve:{creator:function(){return{userToken:vm.loginToken}}}})}}})();(function(){angular.module("fisecApp").controller("roleController",roleController);roleController.$inject=["$scope","$uibModal","userService","roleService"];function roleController($scope,$uibModal,userService,roleService){console.log("inside roleController ...");var vm=this;vm.loginToken=userService.loginToken;vm.pageHeader={title:"FiSec",strapline:"Roles"};vm.message="";vm.onRefresh=function(){console.log("roleController onaRefresh ...");vm.message="loading ...";roleService.roles({userToken:vm.loginToken}).success(function(data){console.log("data %j",data);vm.roles=data.roles;vm.message=""}).error(function(e){console.log(e);vm.message=e})};vm.popupNewRoleForm=function(){console.log("roleController popupNewRoleForm ...");var uibModalInstance=$uibModal.open({templateUrl:"/view/addRoleModal.view.html",controller:"addRoleController as vm",resolve:{creator:function(){return{userToken:vm.loginToken}}}})}}})();(function(){angular.module("fisecApp").controller("userRoleController",userRoleController);userRoleController.$inject=["$scope","$uibModal","userService","roleService"];function userRoleController($scope,$uibModal,userService,roleService){console.log("inside userRoleController ...");var vm=this;vm.loginToken=userService.loginToken;vm.pageHeader={title:"FiSec",strapline:"User's Roles"};vm.message="";vm.onRefresh=function(){console.log("userRoleController onaRefresh ...");vm.message="loading ...";roleService.userRoles({userToken:vm.loginToken}).success(function(data){vm.role_assignments=data.role_assignments;vm.message=""}).error(function(e){console.log(e);vm.message=e})}}})();(function(){angular.module("fisecApp").controller("authController",authController);authController.$inject=["$scope","$window","$uibModal","$location","userService","appService","roleService","authService"];function authController($scope,$window,$uibModal,$location,userService,appService,roleService,authService){console.log("inside authController ...");var vm=this;vm.loginToken=userService.loginToken;vm.pageHeader={title:"FiSec",strapline:"Authorization policy setting"};vm.message="";var init=function(){console.log("authController init ...");vm.message="loading authzforce domain policy info  ...";vm.rules=[];authService.policyVerOfFirstDomain().success(function(data){console.log("data %j",data);vm.domain_id=data.domain_id;vm.policy_ver=(parseFloat(data.policy_ver)+.01).toFixed(2);vm.downloadPolicyUrl="http://"+$location.host()+":8084/authzforce/domains/"+vm.domain_id+"/pap/policies/root/"+data.policy_ver;doLoadApps()}).error(function(e){console.log(e);vm.message=e})};init();var doLoadApps=function(){console.log("authController doLoadApps ...");vm.message="loading application  ...";appService.apps().success(function(data){console.log("data %j",data);vm.consumers=data.consumers;console.log("consumers list %j",vm.consumers);doLoadRoles()}).error(function(e){console.log(e);vm.message=e})};var doLoadRoles=function(){console.log("authController doLoadRoles ...");vm.message="loading roles . . .";roleService.roles({userToken:vm.loginToken}).success(function(data){console.log("data %j",data);vm.roles=data.roles;vm.message=""}).error(function(e){console.log(e);vm.message=e})};vm.addRule=function(){console.log("authController addRule ...");vm.rules.push({})};vm.addPolicy=function(){console.log("authController addPolicy ...");vm.message="Adding ...";console.log("vm %j",vm);authService.addPolicy({domain_id:vm.domain_id,policy_ver:vm.policy_ver,application_id:vm.application_id,rules:vm.rules}).success(function(data){vm.message="";alert("policy created!");init()}).error(function(e){console.log("error %j",e);vm.message=e})};vm.showPolicyWindow=function(){$window.open(vm.downloadPolicyUrl)}}})();(function(){angular.module("fisecApp").controller("mapController",mapController);mapController.$inject=["$scope","$uibModal","$interval","mapService"];function mapController($scope,$uibModal,$interval,mapService){console.log("inside mapController ...");$interval(callAtInterval,5e3);var point1,point2;function callAtInterval(){if(typeof point1=="undefined")point1=mapService.getRandomPointInRegion();if(typeof point2=="undefined")point2=mapService.getRandomPointInRegion();console.log("point 1 %j ",point1);console.log("point 2 %j ",point2)}var vm=this;vm.myLocation={lng:114.156296,lat:22.31948,zoom:14};vm.events={};vm.markers=new Array;vm.paths={};vm.tiles={url:"http://u.ray/osm_tiles/{z}/{x}/{y}.png"};$scope.$on("leafletDirectiveMap.click",function(event,args){console.log("in leafletDirectiveMap.click");var leafEvent=args.leafletEvent;if(typeof vm.startPos=="undefined"){vm.startPos={lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng};vm.markers.push({lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng,message:"My Route start at lat: "+leafEvent.latlng.lat+" long: "+leafEvent.latlng.lng})}else if(typeof vm.endPos=="undefined"){vm.endPos={lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng};vm.markers.push({lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng,message:"My Route end at lat: "+leafEvent.latlng.lat+" long: "+leafEvent.latlng.lng});mapService.findRoute({startPos:vm.startPos,endPos:vm.endPos}).success(function(data){console.log("data %j",data);mapService.decodeRouteGeometory({route_geometry:data.route_geometry}).success(function(data2){console.log("data2 %j",data2);vm.paths={p1:{color:"blue",weight:4,latlngs:data2.route,message:"nearest path!"}};console.log("$scope paths %j",$scope.paths)})}).error(function(e){console.log(e)})}else{delete vm.startPos;delete vm.endPos;vm.markers=new Array;vm.paths={};vm.startPos={lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng};vm.markers.push({lat:leafEvent.latlng.lat,lng:leafEvent.latlng.lng,message:"My Route start at lat: "+leafEvent.latlng.lat+" long: "+leafEvent.latlng.lng})}})}})();(function(){angular.module("fisecApp").controller("secappController",secappController);secappController.$inject=["$scope","$location","$rootScope","$uibModal","appService"];function secappController($scope,$location,$rootScope,$uibModal,appService){console.log("inside secappController ...");var vm=this;vm.defaultUrlPrefix=$location.protocol()+"://"+$location.host()+":81/";vm.pageHeader={title:"FiSec",strapline:"SecApp"};vm.message="";vm.appAccessToken=appService.appAccessToken;vm.authorizedApp=appService.authorizedApp;var init=function(){var queryParameter=$location.search();console.log("queryParameter %j ",queryParameter);console.log("queryParameter length  "+Object.keys(queryParameter).length);if(Object.keys(queryParameter).length!=0){vm.message="loading access token ...";appService.loadAccessToken(queryParameter).success(function(data){console.log("data %j",data);appService.appAccessToken=data.accessToken;vm.appAccessToken=appService.appAccessToken;$rootScope.appAccessToken=appService.appAccessToken;appService.authorizedApp=data.authorizedApp;vm.authorizedApp=appService.authorizedApp;vm.message=""}).error(function(e){console.log(e);vm.message=e})}};init();vm.getRemote=function(){console.log("secappController getRemote ...");appService.invokeRemote({action:"GET",appAccessToken:vm.appAccessToken,urlPrefix:vm.remoteApp.urlPrefix,urlSuffix:vm.remoteApp.urlSuffix}).success(function(data){console.log("data %j",data);vm.message=data}).error(function(e){console.log(e);vm.message=e})};vm.postRemote=function(){console.log("secappController postRemote ...");appService.invokeRemote({action:"POST",appAccessToken:vm.appAccessToken,urlPrefix:vm.remoteApp.urlPrefix,urlSuffix:vm.remoteApp.urlSuffix}).success(function(data){console.log("data %j",data);vm.message=data}).error(function(e){console.log(e);vm.message=e})}}})();(function(){angular.module("fisecApp").filter("addHtmlLineBreaks",addHtmlLineBreaks);function addHtmlLineBreaks(){return function(text){var output=text.replace(/\n/g,"<br/>");return output}}})();(function(){angular.module("fisecApp").service("userService",userService);userService.$inject=["$http"];function userService($http){var loginToken;var users=function(data){console.log("userService users ...");return $http.post("/api/users",data)};var addUser=function(data){console.log("userService addUser ...");console.log("data %j",data);return $http.post("/api/addUser",data)};return{users:users,addUser:addUser,loginToken:loginToken}}})();(function(){angular.module("fisecApp").service("loginService",loginService);loginService.$inject=["$http"];function loginService($http){var login=function(data){console.log("loginService login ...");return $http.post("/api/login",data)};return{login:login}}})();(function(){angular.module("fisecApp").service("appService",appService);appService.$inject=["$http"];function appService($http){var authorizedApp,appAccessToken;var apps=function(){console.log("appService apps ...");return $http.get("/api/consumers")};var loadAccessToken=function(data){console.log("appService loadAccessToken ...");return $http.post("/api/accessToken",data)};var addApp=function(data){console.log("appService addApp ...");console.log("data %j",data);return $http.post("/api/addApp",data)};var invokeRemote=function(data){console.log("appService invokeRemote ...");console.log("data %j",data);requestOption={method:data.action,url:data.urlPrefix+data.urlSuffix,headers:{Accept:"application/json","Content-Type":"application/json","X-Auth-Token":data.appAccessToken}};console.log("requestOption %j",requestOption);return $http(requestOption)};return{appAccessToken:appAccessToken,apps:apps,loadAccessToken:loadAccessToken,addApp:addApp,authorizedApp:authorizedApp,invokeRemote:invokeRemote}}})();(function(){angular.module("fisecApp").service("roleService",roleService);roleService.$inject=["$http"];function roleService($http){var roles=function(data){console.log("roleService roles ...");return $http.post("/api/roles",data)};var addRole=function(data){console.log("roleService addRole ...");console.log("data %j",data);return $http.post("/api/addRole",data)};var userRoles=function(data){console.log("roleService roles ...");return $http.post("/api/userRole",data)};return{roles:roles,addRole:addRole,userRoles:userRoles}}})();(function(){angular.module("fisecApp").service("authService",authService);authService.$inject=["$http"];function authService($http){var policyVerOfFirstDomain=function(){console.log("authService policyVerOfFirstDomain ...");return $http.get("/api/policyVerOfFirstDomain")};var addPolicy=function(data){console.log("authService addPolicy ...");return $http.post("/api/addPolicy",data)};return{policyVerOfFirstDomain:policyVerOfFirstDomain,addPolicy:addPolicy}}})();(function(){angular.module("fisecApp").service("mapService",mapService);mapService.$inject=["$http"];function mapService($http){var getRandomPointInRegion=function(){var randomPoint={longitude:0,latitude:0};while(!geolib.isPointInside(randomPoint,[config.region.NW,config.region.NE,config.region.SE,config.region.SW])){randomPoint={longitude:(Math.random()*(config.region.NW.longitude-config.region.SE.longitude)+config.region.SE.longitude).toFixed(4),latitude:(Math.random()*(config.region.NW.latitude-config.region.SE.latitude)+config.region.SE.latitude).toFixed(4)}}return randomPoint};var findRoute=function(data){console.log("mapService findRoute ...");url="http://router.project-osrm.org/viaroute"+"?loc="+data.startPos.lat+","+data.startPos.lng+"&loc="+data.endPos.lat+","+data.endPos.lng+"&instructions=true";return $http.get(url)};var decodeRouteGeometory=function(data){console.log("mapService decodeRouteGeometory ...");console.log("data %j",data);return $http.post("/api/decodeRouteGeometory",data)};return{findRoute:findRoute,decodeRouteGeometory:decodeRouteGeometory,getRandomPointInRegion:getRandomPointInRegion}}})();(function(){angular.module("fisecApp").directive("navigation",navigation);function navigation(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("fisecApp").directive("footerGeneric",footerGeneric);function footerGeneric(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("fisecApp").directive("pageHeader",pageHeader);function pageHeader(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();